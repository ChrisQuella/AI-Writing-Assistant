<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯• - æ™ºèƒ½å†™ä½œåŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ§ª æ™ºèƒ½å†™ä½œåŠ©æ‰‹ - åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="space-y-6">
            <!-- æµ‹è¯•çŠ¶æ€ -->
            <div id="testStatus" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h2 class="text-lg font-semibold text-blue-800 mb-2">æµ‹è¯•çŠ¶æ€</h2>
                <p class="text-blue-700">å‡†å¤‡å¼€å§‹æµ‹è¯•...</p>
            </div>

            <!-- æµ‹è¯•æŒ‰é’® -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="testLocalStorage()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition">
                    æµ‹è¯• LocalStorage
                </button>
                <button onclick="testHistoryFunctions()" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition">
                    æµ‹è¯•å†å²è®°å½•åŠŸèƒ½
                </button>
                <button onclick="testUIElements()" class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition">
                    æµ‹è¯• UI å…ƒç´ 
                </button>
                <button onclick="testPromptTemplates()" class="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition">
                    æµ‹è¯•æç¤ºè¯æ¨¡æ¿
                </button>
                <button onclick="clearTestData()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition">
                    æ¸…é™¤æµ‹è¯•æ•°æ®
                </button>
                <button onclick="runAllTests()" class="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 transition">
                    è¿è¡Œæ‰€æœ‰æµ‹è¯•
                </button>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div id="testResults" class="bg-gray-50 border border-gray-200 rounded-lg p-4 min-h-[300px]">
                <h2 class="text-lg font-semibold text-gray-800 mb-2">æµ‹è¯•ç»“æœ</h2>
                <div id="resultsContent" class="text-sm text-gray-700 space-y-2">
                    <p>ç­‰å¾…æµ‹è¯•...</p>
                </div>
            </div>

            <!-- å¿«é€Ÿé“¾æ¥ -->
            <div class="flex gap-4">
                <a href="index.html" class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-lg text-center hover:from-blue-600 hover:to-indigo-700 transition">
                    æ‰“å¼€ä¸»åº”ç”¨
                </a>
                <a href="TEST_CHECKLIST.md" target="_blank" class="flex-1 bg-gray-200 text-gray-700 px-6 py-3 rounded-lg text-center hover:bg-gray-300 transition">
                    æŸ¥çœ‹æµ‹è¯•æ¸…å•
                </a>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-orange-600',
                info: 'text-blue-600'
            };
            
            testResults.push(`<p class="${colors[type]}">[${timestamp}] ${message}</p>`);
            updateResults();
        }

        function updateResults() {
            document.getElementById('resultsContent').innerHTML = testResults.join('');
        }

        function updateStatus(message) {
            document.getElementById('testStatus').innerHTML = `
                <h2 class="text-lg font-semibold text-blue-800 mb-2">æµ‹è¯•çŠ¶æ€</h2>
                <p class="text-blue-700">${message}</p>
            `;
        }

        // æµ‹è¯• 1: LocalStorage
        function testLocalStorage() {
            testResults = [];
            updateStatus('æ­£åœ¨æµ‹è¯• LocalStorage...');
            
            try {
                // æµ‹è¯•å†™å…¥
                localStorage.setItem('test_key', 'test_value');
                log('âœ… LocalStorage å†™å…¥æµ‹è¯•é€šè¿‡', 'success');
                
                // æµ‹è¯•è¯»å–
                const value = localStorage.getItem('test_key');
                if (value === 'test_value') {
                    log('âœ… LocalStorage è¯»å–æµ‹è¯•é€šè¿‡', 'success');
                } else {
                    log('âŒ LocalStorage è¯»å–æµ‹è¯•å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•åˆ é™¤
                localStorage.removeItem('test_key');
                log('âœ… LocalStorage åˆ é™¤æµ‹è¯•é€šè¿‡', 'success');
                
                // æ£€æŸ¥ API Key
                const apiKey = localStorage.getItem('zhipu_api_key');
                if (apiKey) {
                    log(`âœ… å‘ç°å·²ä¿å­˜çš„ API Key: ${apiKey.substring(0, 10)}...`, 'success');
                } else {
                    log('âš ï¸ æœªå‘ç° API Keyï¼Œè¯·åœ¨ä¸»åº”ç”¨ä¸­è®¾ç½®', 'warning');
                }
                
                // æ£€æŸ¥å†å²è®°å½•
                const history = localStorage.getItem('writingHistory');
                if (history) {
                    const records = JSON.parse(history);
                    log(`âœ… å‘ç° ${records.length} æ¡å†å²è®°å½•`, 'success');
                } else {
                    log('â„¹ï¸ æš‚æ— å†å²è®°å½•', 'info');
                }
                
                updateStatus('LocalStorage æµ‹è¯•å®Œæˆ');
            } catch (error) {
                log(`âŒ LocalStorage æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('LocalStorage æµ‹è¯•å¤±è´¥');
            }
        }

        // æµ‹è¯• 2: å†å²è®°å½•åŠŸèƒ½
        function testHistoryFunctions() {
            testResults = [];
            updateStatus('æ­£åœ¨æµ‹è¯•å†å²è®°å½•åŠŸèƒ½...');
            
            try {
                // åˆ›å»ºæµ‹è¯•è®°å½•
                const testRecord = {
                    id: Date.now(),
                    mode: 'continue',
                    modeName: 'ğŸ“– æ–‡ç« ç»­å†™',
                    prompt: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æç¤ºè¯ï¼Œç”¨äºéªŒè¯å†å²è®°å½•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚',
                    input: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æç¤ºè¯...',
                    output: 'è¿™æ˜¯æµ‹è¯•ç”Ÿæˆçš„å†…å®¹ã€‚\n\nåŒ…å«å¤šè¡Œæ–‡æœ¬ã€‚\n\nç”¨äºéªŒè¯å†å²è®°å½•çš„ä¿å­˜å’ŒåŠ è½½åŠŸèƒ½ã€‚',
                    temperature: 0.7,
                    maxTokens: 1500,
                    timestamp: new Date().toLocaleString('zh-CN'),
                    timestampRaw: Date.now()
                };
                
                // è·å–ç°æœ‰å†å²
                let history = JSON.parse(localStorage.getItem('writingHistory') || '[]');
                log(`â„¹ï¸ å½“å‰å†å²è®°å½•æ•°: ${history.length}`, 'info');
                
                // æ·»åŠ æµ‹è¯•è®°å½•
                history.unshift(testRecord);
                localStorage.setItem('writingHistory', JSON.stringify(history));
                log('âœ… æµ‹è¯•è®°å½•å·²æ·»åŠ ', 'success');
                
                // éªŒè¯ä¿å­˜
                const saved = JSON.parse(localStorage.getItem('writingHistory'));
                if (saved[0].id === testRecord.id) {
                    log('âœ… è®°å½•ä¿å­˜éªŒè¯é€šè¿‡', 'success');
                } else {
                    log('âŒ è®°å½•ä¿å­˜éªŒè¯å¤±è´¥', 'error');
                }
                
                // æµ‹è¯•è®°å½•é™åˆ¶
                if (history.length > 100) {
                    history = history.slice(0, 100);
                    localStorage.setItem('writingHistory', JSON.stringify(history));
                    log('âœ… è®°å½•æ•°é‡é™åˆ¶æµ‹è¯•é€šè¿‡ï¼ˆæœ€å¤š100æ¡ï¼‰', 'success');
                }
                
                log(`â„¹ï¸ æ›´æ–°åå†å²è®°å½•æ•°: ${history.length}`, 'info');
                updateStatus('å†å²è®°å½•åŠŸèƒ½æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                log(`âŒ å†å²è®°å½•åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('å†å²è®°å½•åŠŸèƒ½æµ‹è¯•å¤±è´¥');
            }
        }

        // æµ‹è¯• 3: UI å…ƒç´ 
        function testUIElements() {
            testResults = [];
            updateStatus('æ­£åœ¨æµ‹è¯• UI å…ƒç´ ...');
            
            const elements = [
                'writingMode',
                'inputText',
                'temperature',
                'tempValue',
                'maxTokens',
                'maxTokensValue',
                'optimizeBtn',
                'generateBtn',
                'outputArea',
                'copyBtn',
                'historyList',
                'clearHistoryBtn',
                'settingsBtn',
                'advancedToggle',
                'advancedPanel'
            ];
            
            log('â„¹ï¸ æ³¨æ„ï¼šæ­¤æµ‹è¯•éœ€è¦åœ¨ä¸»åº”ç”¨é¡µé¢è¿è¡Œ', 'warning');
            log('â„¹ï¸ è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œåœ¨ä¸»åº”ç”¨é¡µé¢è¿è¡Œä»¥ä¸‹ä»£ç ï¼š', 'info');
            
            const testCode = `
// UI å…ƒç´ æµ‹è¯•
const elements = ${JSON.stringify(elements)};
let passed = 0;
let failed = 0;

elements.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
        console.log('âœ…', id, '- å­˜åœ¨');
        passed++;
    } else {
        console.error('âŒ', id, '- ä¸å­˜åœ¨');
        failed++;
    }
});

console.log(\`\\næµ‹è¯•ç»“æœ: \${passed} é€šè¿‡, \${failed} å¤±è´¥\`);
            `;
            
            log(`<pre class="bg-gray-800 text-green-400 p-4 rounded mt-2 overflow-x-auto">${testCode}</pre>`, 'info');
            updateStatus('UI å…ƒç´ æµ‹è¯•è¯´æ˜å·²æ˜¾ç¤º');
        }

        // æµ‹è¯• 4: æç¤ºè¯æ¨¡æ¿
        function testPromptTemplates() {
            testResults = [];
            updateStatus('æ­£åœ¨æµ‹è¯•æç¤ºè¯æ¨¡æ¿...');
            
            const templates = {
                continue: (input) => `è¯·ç»§ç»­å†™ä¸‹é¢çš„æ–‡ç« ï¼Œä¿æŒé£æ ¼ä¸€è‡´ï¼Œå†…å®¹è¿è´¯ï¼š\n\n${input}`,
                rewrite: (input) => `è¯·æ”¹å†™ä¸‹é¢çš„å†…å®¹ï¼Œä½¿å…¶æ›´åŠ æµç•…ã€ä¸“ä¸šï¼š\n\n${input}`,
                expand: (input) => `è¯·æ‰©å±•ä¸‹é¢çš„å†…å®¹ï¼Œå¢åŠ æ›´å¤šç»†èŠ‚å’Œä¾‹å­ï¼š\n\n${input}`,
                summarize: (input) => `è¯·æ€»ç»“ä¸‹é¢çš„å†…å®¹ï¼Œæå–æ ¸å¿ƒè¦ç‚¹ï¼š\n\n${input}`,
                email: (input) => `è¯·å†™ä¸€å°ä¸“ä¸šçš„é‚®ä»¶ï¼Œä¸»é¢˜æ˜¯ï¼š\n\n${input}`,
                copywriting: (input) => `è¯·ä¸ºä»¥ä¸‹å†…å®¹å†™ä¸€æ®µå¸å¼•äººçš„è¥é”€æ–‡æ¡ˆï¼š\n\n${input}`
            };
            
            const testInput = 'äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œ';
            
            Object.keys(templates).forEach(mode => {
                try {
                    const result = templates[mode](testInput);
                    if (result.includes(testInput)) {
                        log(`âœ… ${mode} æ¨¡æ¿æµ‹è¯•é€šè¿‡`, 'success');
                    } else {
                        log(`âŒ ${mode} æ¨¡æ¿æµ‹è¯•å¤±è´¥`, 'error');
                    }
                } catch (error) {
                    log(`âŒ ${mode} æ¨¡æ¿æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
                }
            });
            
            updateStatus('æç¤ºè¯æ¨¡æ¿æµ‹è¯•å®Œæˆ');
        }

        // æ¸…é™¤æµ‹è¯•æ•°æ®
        function clearTestData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æµ‹è¯•æ•°æ®å—ï¼Ÿè¿™å°†åˆ é™¤ API Key å’Œå†å²è®°å½•ï¼')) {
                testResults = [];
                updateStatus('æ­£åœ¨æ¸…é™¤æµ‹è¯•æ•°æ®...');
                
                try {
                    localStorage.removeItem('zhipu_api_key');
                    log('âœ… API Key å·²æ¸…é™¤', 'success');
                    
                    localStorage.removeItem('writingHistory');
                    log('âœ… å†å²è®°å½•å·²æ¸…é™¤', 'success');
                    
                    updateStatus('æµ‹è¯•æ•°æ®æ¸…é™¤å®Œæˆ');
                } catch (error) {
                    log(`âŒ æ¸…é™¤å¤±è´¥: ${error.message}`, 'error');
                    updateStatus('æµ‹è¯•æ•°æ®æ¸…é™¤å¤±è´¥');
                }
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            testResults = [];
            updateStatus('æ­£åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            log('========== å¼€å§‹æµ‹è¯• ==========', 'info');
            
            // æµ‹è¯• 1
            log('\n--- æµ‹è¯• 1: LocalStorage ---', 'info');
            testLocalStorage();
            
            await sleep(1000);
            
            // æµ‹è¯• 2
            log('\n--- æµ‹è¯• 2: å†å²è®°å½•åŠŸèƒ½ ---', 'info');
            testHistoryFunctions();
            
            await sleep(1000);
            
            // æµ‹è¯• 4
            log('\n--- æµ‹è¯• 4: æç¤ºè¯æ¨¡æ¿ ---', 'info');
            testPromptTemplates();
            
            log('\n========== æµ‹è¯•å®Œæˆ ==========', 'info');
            log('â„¹ï¸ UI å…ƒç´ æµ‹è¯•éœ€è¦åœ¨ä¸»åº”ç”¨é¡µé¢æ‰‹åŠ¨è¿è¡Œ', 'warning');
            
            updateStatus('æ‰€æœ‰è‡ªåŠ¨æµ‹è¯•å®Œæˆ');
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            log('ğŸ‘‹ æ¬¢è¿ä½¿ç”¨æ™ºèƒ½å†™ä½œåŠ©æ‰‹æµ‹è¯•å·¥å…·', 'info');
            log('â„¹ï¸ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•', 'info');
        };
    </script>
</body>
</html>
